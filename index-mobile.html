<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#080c10">
<title>ELIP_SNACK // SYS</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root {
--neon-green: #00ff88;
--neon-cyan: #00e5ff;
--neon-red: #ff3366;
--neon-purple: #b366ff;
--bg: #080c10;
--panel: #0d1520;
--border: #1a2a3a;
--glow-green: 0 0 8px #00ff88, 0 0 20px #00ff8855;
--glow-cyan: 0 0 8px #00e5ff, 0 0 20px #00e5ff55;
--glow-red: 0 0 8px #ff3366, 0 0 25px #ff336655;
--glow-purple: 0 0 8px #b366ff, 0 0 20px #b366ff55;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
background: var(--bg);
font-family: 'Share Tech Mono', monospace;
color: var(--neon-green);
min-height: 100vh;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
overflow: hidden;
touch-action: none;
-webkit-user-select: none;
user-select: none;
padding: 10px;
}

body::before {
content: '';
position: fixed;
inset: 0;
background: repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.07) 2px,rgba(0,0,0,0.07) 4px);
pointer-events: none;
z-index: 100;
}

body::after {
content: '';
position: fixed;
inset: 0;
background: radial-gradient(ellipse at center, transparent 60%, rgba(0,0,0,0.7) 100%);
pointer-events: none;
z-index: 99;
}

.wrapper {
display: flex;
flex-direction: column;
align-items: center;
gap: 16px;
animation: fadeIn 0.8s ease;
max-width: 100%;
width: 100%;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to   { opacity: 1; transform: translateY(0); }
}

header {
display: flex;
align-items: center;
justify-content: space-between;
width: 100%;
padding: 0 4px;
flex-wrap: wrap;
gap: 8px;
}

.logo {
font-family: 'Orbitron', sans-serif;
font-weight: 900;
font-size: clamp(16px, 5vw, 22px);
letter-spacing: 6px;
color: var(--neon-green);
text-shadow: var(--glow-green);
}

.logo span {
color: var(--neon-cyan);
text-shadow: var(--glow-cyan);
}

.sys-tag {
font-size: clamp(8px, 2vw, 10px);
color: #2a5a4a;
letter-spacing: 2px;
}

.hud {
display: flex;
gap: clamp(12px, 3vw, 24px);
width: 100%;
padding: 0 4px;
flex-wrap: wrap;
justify-content: center;
}

.hud-item {
display: flex;
flex-direction: column;
min-width: 60px;
}

.hud-label {
font-size: clamp(7px, 2vw, 9px);
letter-spacing: 3px;
color: #2a6a5a;
}

.hud-value {
font-family: 'Orbitron', sans-serif;
font-size: clamp(14px, 4vw, 18px);
font-weight: 700;
color: var(--neon-cyan);
text-shadow: var(--glow-cyan);
transition: transform 0.1s;
}

.hud-value.pop {
animation: pop 0.15s ease;
}

@keyframes pop {
0%   { transform: scale(1); }
50%  { transform: scale(1.3); color: var(--neon-green); }
100% { transform: scale(1); }
}

.canvas-wrap {
position: relative;
border: 1px solid var(--neon-green);
box-shadow: var(--glow-green), inset 0 0 40px rgba(0,255,136,0.03);
touch-action: none;
max-width: 100%;
width: min(400px, 100vw - 20px);
height: min(400px, 100vw - 20px);
}

.canvas-wrap::before,
.canvas-wrap::after {
content: '';
position: absolute;
width: 8px; height: 8px;
border-color: var(--neon-cyan);
border-style: solid;
}

.canvas-wrap::before { top: -1px; left: -1px; border-width: 2px 0 0 2px; }
.canvas-wrap::after  { bottom: -1px; right: -1px; border-width: 0 2px 2px 0; }

canvas { 
display: block;
width: 100%;
height: 100%;
}

.overlay {
position: absolute;
inset: 0;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
background: rgba(8,12,16,0.88);
backdrop-filter: blur(2px);
gap: 20px;
transition: opacity 0.4s;
}

.overlay.hidden { opacity: 0; pointer-events: none; }

.overlay-title {
font-family: 'Orbitron', sans-serif;
font-size: clamp(24px, 8vw, 32px);
font-weight: 900;
letter-spacing: 6px;
text-align: center;
}

.overlay-title.green { color: var(--neon-green); text-shadow: var(--glow-green); }
.overlay-title.red   { color: var(--neon-red);   text-shadow: var(--glow-red); }

.overlay-sub {
font-size: clamp(14px, 4vw, 18px);
letter-spacing: 3px;
color: #ff3366;
text-align: center;
font-weight: 700;
text-shadow: var(--glow-red);
padding: 0 10px;
}

.stage-message {
position: absolute;
top: 20%;
left: 50%;
transform: translate(-50%, -50%);
font-family: 'Orbitron', sans-serif;
font-size: clamp(16px, 5vw, 20px);
font-weight: 900;
color: var(--neon-cyan);
text-shadow: var(--glow-cyan);
opacity: 0;
pointer-events: none;
animation: messagePopup 2s ease;
z-index: 10;
}

@keyframes messagePopup {
0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
}

.final-score {
font-family: 'Orbitron', sans-serif;
font-size: clamp(32px, 10vw, 42px);
font-weight: 900;
color: var(--neon-cyan);
text-shadow: var(--glow-cyan);
}

.btn {
font-family: 'Orbitron', sans-serif;
font-size: clamp(10px, 3vw, 12px);
font-weight: 700;
letter-spacing: 4px;
padding: clamp(10px, 3vw, 12px) clamp(24px, 8vw, 32px);
background: transparent;
border: 1px solid var(--neon-green);
color: var(--neon-green);
cursor: pointer;
text-shadow: var(--glow-green);
box-shadow: var(--glow-green);
transition: all 0.2s;
position: relative;
overflow: hidden;
}

.btn::before {
content: '';
position: absolute;
inset: 0;
background: var(--neon-green);
opacity: 0;
transition: opacity 0.2s;
}

.btn:hover {
color: var(--bg);
text-shadow: none;
box-shadow: none;
}

.btn:hover::before { opacity: 1; }
.btn span { position: relative; z-index: 1; }

.controls {
display: flex;
gap: clamp(10px, 3vw, 20px);
font-size: clamp(8px, 2vw, 10px);
color: #2a4a3a;
letter-spacing: 2px;
width: 100%;
justify-content: center;
flex-wrap: wrap;
}

.key {
display: inline-block;
border: 1px solid #1a3a2a;
padding: 1px 5px;
border-radius: 2px;
color: #3a7a5a;
}

.speed-bar-wrap {
display: flex;
align-items: center;
gap: 10px;
width: 100%;
padding: 0 4px;
}

.speed-label { 
font-size: clamp(7px, 2vw, 9px); 
letter-spacing: 2px; 
color: #2a5a4a; 
white-space: nowrap;
}

.speed-bar {
flex: 1;
height: 3px;
background: #0d1a10;
position: relative;
overflow: hidden;
}

.speed-fill {
height: 100%;
background: linear-gradient(to right, var(--neon-green), var(--neon-cyan));
box-shadow: 0 0 6px var(--neon-green);
transition: width 0.4s ease;
width: 10%;
}

@keyframes flicker {
0%, 100% { opacity: 1; }
30% { opacity: 0.6; }
50% { opacity: 0.9; }
70% { opacity: 0.4; }
}

.flicker { animation: flicker 0.4s ease; }
</style>
</head>
<body>
<div class="wrapper">
<header>
<div class="logo">ELIP_<span>S</span>NACK</div>
<div class="sys-tag">SYS_v2.4 // MOBILE</div>
</header>

<div class="hud">
<div class="hud-item">
<span class="hud-label">SCORE</span>
<span class="hud-value" id="score">0000</span>
</div>
<div class="hud-item">
<span class="hud-label">BEST</span>
<span class="hud-value" id="best">0000</span>
</div>
<div class="hud-item">
<span class="hud-label">LENGTH</span>
<span class="hud-value" id="length">01</span>
</div>
<div class="hud-item">
<span class="hud-label">FRUITS</span>
<span class="hud-value" id="fruits">0</span>
</div>
<div class="hud-item" id="shield-indicator" style="display:none;">
<span class="hud-label">üõ°Ô∏è BOUCLIER</span>
<span class="hud-value" style="color: #b366ff;" id="shield-time">0</span>
</div>
<div class="hud-item" id="invisibility-indicator" style="display:none;">
<span class="hud-label">üëÅÔ∏è INVISIBLE</span>
<span class="hud-value" style="color: #ffaa00;" id="invisibility-time">0</span>
</div>
</div>

<div class="canvas-wrap">
<canvas id="canvas" width="400" height="400"></canvas>
<div class="stage-message" id="stage-message"></div>
<div class="overlay" id="overlay">
<div class="overlay-title green" id="overlay-title">ELIP_SNACK</div>
<div class="overlay-sub" id="overlay-sub">SYST√àME PR√äT</div>
<div class="final-score" id="final-score" style="display:none">0000</div>
<div style="display: flex; flex-direction: column; gap: 16px;">
<button class="btn" id="continue-btn" style="display:none"><span>CONTINUER</span></button>
<button class="btn" id="start-btn"><span>INITIALISER</span></button>
</div>
</div>
</div>

<div class="speed-bar-wrap">
<span class="speed-label">VITESSE</span>
<div class="speed-bar">
<div class="speed-fill" id="speed-fill"></div>
</div>
<span class="speed-label" id="speed-level">LV.1</span>
</div>

<div class="controls">
<span><span class="key">üëÜ</span> SWIPE POUR DIRIGER</span>
</div>
</div>

<!-- Capacitor Core -->
<script type="module">
import { Capacitor } from 'https://cdn.jsdelivr.net/npm/@capacitor/core@6/dist/index.js';
import { App } from 'https://cdn.jsdelivr.net/npm/@capacitor/app@6/dist/index.js';
import { Haptics, ImpactStyle } from 'https://cdn.jsdelivr.net/npm/@capacitor/haptics@6/dist/index.js';
import { StatusBar, Style } from 'https://cdn.jsdelivr.net/npm/@capacitor/status-bar@6/dist/index.js';

// Configuration pour mobile
if (Capacitor.isNativePlatform()) {
  // Configurer la barre de statut
  StatusBar.setStyle({ style: Style.Dark });
  StatusBar.setBackgroundColor({ color: '#080c10' });
  
  // G√©rer le bouton retour Android
  App.addListener('backButton', ({ canGoBack }) => {
    if (!canGoBack) {
      App.exitApp();
    }
  });
}

// Fonction pour vibration haptique
window.triggerHaptic = async (type = 'light') => {
  if (Capacitor.isNativePlatform()) {
    try {
      if (type === 'heavy') {
        await Haptics.impact({ style: ImpactStyle.Heavy });
      } else if (type === 'medium') {
        await Haptics.impact({ style: ImpactStyle.Medium });
      } else {
        await Haptics.impact({ style: ImpactStyle.Light });
      }
    } catch (e) {
      console.log('Haptics not available');
    }
  }
};
</script>

<script>
// Le code du jeu reste identique, on ajoute juste les vibrations
